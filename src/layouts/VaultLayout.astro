---
import type { CollectionEntry } from 'astro:content';
import BaseLayout from './Layout.astro';
import Header from '@/components/site/Header.astro';
import { DynamicIcon } from '@/components/ui/DynamicIcon';
import SkillList from '@/components/skills/SkillList.astro';

interface Props {
  frontmatter: CollectionEntry<'vaults'>['data'];
  canonical: string;
  skills: CollectionEntry<'skills'>[];
}

const { frontmatter, canonical, skills } = Astro.props;
---


<BaseLayout
  title={frontmatter.name}
  description={frontmatter.description}
  canonical={canonical}
  lang="en"
>
  <Header />

  <main class="py-20">
    <article>
      <!-- Vault Breadcrumb -->
      <nav class="mb-6">
        <a
          href="/skills/"
          class="text-sm text-muted-foreground hover:text-primary-300 transition-colors"
        >
          ← Back to all skills
        </a>
      </nav>
      

      <!-- Vault Header -->
      <header>        
        <div class="flex items-start justify-between gap-4">
          <div class="flex-1">
            <h1 class="mb-3 text-3xl font-bold flex items-center gap-3">
              <DynamicIcon name={frontmatter.icon} className="text-purple-600 size-5" client:load />
              {frontmatter.name}
            </h1>
            <p class="text-lg text-muted-foreground">{frontmatter.description}</p>
          </div>
          
          {frontmatter.submodule && (
            <a
              href={`/downloads/${Astro.url.pathname.split('/').filter(Boolean).pop()}-vault.zip`}
              download
              class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-foreground bg-zinc-800 hover:bg-zinc-700 rounded-lg transition-colors shrink-0"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              Download
            </a>
          )}
        </div>
      </header>

      <!-- Skills in this vault (dynamically fetched) -->
      {skills.length > 0 && (
        <section class="mt-10">
          <h2 class="text-xl font-semibold mb-2 ml-1">Skills in this vault</h2>
          <SkillList class='border border-border rounded-lg' skills={skills} />
        </section>
      )}

      <hr class="border-dashed-x my-10" />

      <!-- Vault Content -->
      <div class="text-xl text-foreground">
        <slot />
      </div>

      <!-- Back to Skills -->
      <div class="mt-16 pt-8 border-t border-border">
        <a
          href="/skills/"
          class="text-sm text-muted-foreground hover:text-primary-300 transition-colors"
        >
          ← Back to all skills
        </a>
      </div>
    </article>
  </main>
</BaseLayout>
