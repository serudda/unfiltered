---
import type { CollectionEntry } from 'astro:content';
import BaseLayout from './Layout.astro';
import Header from '@/components/site/Header.astro';
import Tag from '@/components/ui/Tag.astro';
import { formatRelativeTime } from '@/utils/dates';

interface Props {
  frontmatter: CollectionEntry<'skills'>['data'];
  canonical: string;
}

const { frontmatter, canonical } = Astro.props;

// Format date
const dateObj = new Date(frontmatter.lastUpdated);
const day = dateObj.getDate();
const year = dateObj.getFullYear();
const month = dateObj.toLocaleDateString('en-US', { month: 'long' });
const capitalizedMonth = month.charAt(0).toUpperCase() + month.slice(1);

const formattedDate = `${capitalizedMonth} ${day}, ${year}`;
const relativeTime = formatRelativeTime(frontmatter.lastUpdated);
---

<BaseLayout
  title={frontmatter.name}
  description={frontmatter.tagline}
  canonical={canonical}
  lang="en"
>
  <Header />

  <main class="py-20">
    <article>
      <!-- Skill Header -->
      <header>
        <div class="flex items-center gap-3 mb-4">
          <Tag color={frontmatter.accentColor} size="xs">
            {frontmatter.installCommand}
          </Tag>
          <span class="text-xs text-muted-foreground">v{frontmatter.version}</span>
        </div>

        <h1 class="mb-2 text-2xl font-bold">{frontmatter.name}</h1>
        <p class="text-xl text-muted-foreground font-serif">{frontmatter.tagline}</p>

        <div class="flex items-center gap-2 mt-4 text-sm text-muted-foreground">
          <span>Last updated:</span>
          <time datetime={frontmatter.lastUpdated.toISOString()}>
            {formattedDate} ({relativeTime})
          </time>
        </div>
      </header>

      <!-- Features -->
      {frontmatter.features.length > 0 && (
        <section class="mt-10">
          <h2 class="text-lg font-semibold mb-4">Features</h2>
          <ul class="ml-6 list-disc ps-4 marker:text-primary-400 space-y-2">
            {frontmatter.features.map((feature) => (
              <li class="text-foreground">{feature}</li>
            ))}
          </ul>
        </section>
      )}

      <hr class="border-dashed-x my-10" />

      <!-- Skill Content -->
      <div class="font-serif text-xl text-foreground">
        <slot />
      </div>

      <!-- Back to Skills -->
      <div class="mt-16 pt-8 border-t border-border">
        <a
          href="/skills/"
          class="text-sm text-muted-foreground hover:text-primary-300 transition-colors"
        >
          ‚Üê Back to all skills
        </a>
      </div>
    </article>
  </main>
</BaseLayout>
