---
import type { CollectionEntry } from 'astro:content';
import BaseLayout from './Layout.astro';
import Header from '@/components/site/Header.astro';
import Tag from '@/components/ui/Tag.astro';

interface Props {
  frontmatter: CollectionEntry<'skills'>['data'];
  canonical: string;
  vault?: CollectionEntry<'vaults'>;
}

const { frontmatter, canonical, vault } = Astro.props;

---

<BaseLayout
  title={frontmatter.name}
  description={frontmatter.tagline}
  canonical={canonical}
  lang="en"
>
  <Header />

  <main class="py-20">
    <article>
      <!-- Vault Breadcrumb (if skill belongs to a vault) -->
      {vault && (
        <nav class="mb-6">
          <a 
            href={`/skills/vaults/${vault.slug}/`}
            class="text-sm text-muted-foreground hover:text-primary-300 transition-colors"
          >
            ← Back to {vault.data.name} Vault
          </a>
        </nav>
      )}

      <!-- Vault Header -->
      <header>        
        <h1 class="mb-3 text-3xl font-bold flex items-center gap-3">
          {frontmatter.name}
          <Tag color="purple" size="xs">
            {frontmatter.command}
          </Tag>
        </h1>
        <p class="text-lg text-muted-foreground">{frontmatter.description}</p>
      </header>

      <hr class="border-dashed-x my-10" />

      <!-- Features -->
      {frontmatter.flow.length > 0 && (
        <section class="mt-10">
          <h2 class="text-2xl font-semibold mb-4">Flow</h2>
          <ul class="ml-6 list-disc ps-4 marker:text-primary-400 space-y-2">
            {frontmatter.flow.map((feature) => (
              <li class="text-foreground">{feature}</li>
            ))}
          </ul>
        </section>
      )}

      <hr class="border-dashed-x my-10" />

      <!-- Skill Content -->
      <slot />

      <!-- Back Navigation -->
      <div class="mt-16 pt-8 border-t border-border">
        {vault ? (
          <a 
            href={`/skills/vaults/${vault.slug}/`}
            class="text-sm text-muted-foreground hover:text-primary-300 transition-colors"
          >
            ← Back to {vault.data.name} Vault
          </a>
        ) : (
          <a 
            href={'/skills/'}
            class="text-sm text-muted-foreground hover:text-primary-300 transition-colors"
          >
            ← Back to Skills
          </a>
        )}
      </div>
    </article>
  </main>
</BaseLayout>
